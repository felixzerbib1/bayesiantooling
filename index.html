<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Feature Flag Configuration Viewer</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --blue-50: #eff6ff;
    --blue-100: #dbeafe;
    --blue-500: #3b82f6;
    --blue-600: #2563eb;
    --blue-700: #1d4ed8;
    --blue-800: #1e40af;
    --blue-900: #1e3a5f;
    --green-50: #f0fdf4;
    --green-100: #dcfce7;
    --green-600: #16a34a;
    --green-700: #15803d;
    --red-50: #fef2f2;
    --red-100: #fee2e2;
    --red-600: #dc2626;
    --red-700: #b91c1c;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-400: #9ca3af;
    --gray-500: #6b7280;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --gray-900: #111827;
    --amber-50: #fffbeb;
    --amber-100: #fef3c7;
    --amber-600: #d97706;
    --purple-50: #faf5ff;
    --purple-100: #f3e8ff;
    --purple-600: #9333ea;
    --teal-50: #f0fdfa;
    --teal-600: #0d9488;
    --orange-50: #fff7ed;
    --orange-600: #ea580c;
    --radius: 8px;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
    --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
    --shadow-md: 0 4px 6px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.06);
    --shadow-lg: 0 10px 15px rgba(0,0,0,0.1), 0 4px 6px rgba(0,0,0,0.05);
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background: var(--gray-50);
    color: var(--gray-800);
    line-height: 1.5;
    min-height: 100vh;
  }

  .header {
    background: linear-gradient(135deg, var(--blue-800), var(--blue-900));
    color: white;
    padding: 20px 32px;
    box-shadow: var(--shadow-md);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .header-inner {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 16px;
  }
  .header h1 { font-size: 20px; font-weight: 600; letter-spacing: -0.3px; }
  .header-subtitle { font-size: 13px; opacity: 0.75; margin-top: 2px; }
  .header-right { display: flex; align-items: center; gap: 12px; }
  .last-updated { font-size: 12px; opacity: 0.6; }

  .search-box { position: relative; }
  .search-box input {
    padding: 8px 12px 8px 36px;
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: var(--radius);
    background: rgba(255,255,255,0.1);
    color: white;
    font-size: 14px;
    width: 260px;
    outline: none;
    transition: all 0.2s;
  }
  .search-box input::placeholder { color: rgba(255,255,255,0.5); }
  .search-box input:focus { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.4); width: 320px; }
  .search-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); opacity: 0.5; }

  .main { max-width: 1400px; margin: 0 auto; padding: 24px 32px 48px; }

  .stats-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
  .stat-card { background: white; border-radius: var(--radius); padding: 16px 20px; box-shadow: var(--shadow-sm); border: 1px solid var(--gray-200); }
  .stat-card .stat-label { font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--gray-500); margin-bottom: 4px; }
  .stat-card .stat-value { font-size: 28px; font-weight: 700; color: var(--gray-900); }
  .stat-card .stat-detail { font-size: 12px; color: var(--gray-400); margin-top: 2px; }

  .filter-bar { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
  .filter-bar label { font-size: 13px; font-weight: 600; color: var(--gray-600); }
  .filter-group { display: flex; align-items: center; gap: 6px; }
  .filter-chip {
    padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 500;
    border: 1px solid var(--gray-300); background: white; color: var(--gray-600);
    cursor: pointer; transition: all 0.15s; user-select: none;
  }
  .filter-chip:hover { border-color: var(--blue-500); color: var(--blue-600); }
  .filter-chip.active { background: var(--blue-600); color: white; border-color: var(--blue-600); }
  .filter-divider { width: 1px; height: 24px; background: var(--gray-300); margin: 0 4px; }

  .tabs { display: flex; gap: 0; margin-bottom: 24px; border-bottom: 2px solid var(--gray-200); }
  .tab {
    padding: 10px 20px; font-size: 14px; font-weight: 500; color: var(--gray-500);
    cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px;
    transition: all 0.15s; user-select: none;
  }
  .tab:hover { color: var(--gray-700); }
  .tab.active { color: var(--blue-600); border-bottom-color: var(--blue-600); }

  .matrix-container { overflow-x: auto; background: white; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--gray-200); }
  .matrix-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .matrix-table thead th {
    background: var(--gray-50); padding: 12px 16px; text-align: left; font-weight: 600;
    color: var(--gray-700); border-bottom: 2px solid var(--gray-200); white-space: nowrap;
    position: sticky; top: 0; z-index: 10;
  }
  .matrix-table thead th:first-child { position: sticky; left: 0; z-index: 20; background: var(--gray-50); min-width: 220px; }
  .matrix-table thead .col-header-customer { font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--gray-400); }
  .matrix-table thead .col-header-product { font-size: 13px; font-weight: 600; color: var(--gray-700); }
  .matrix-table tbody td { padding: 10px 16px; border-bottom: 1px solid var(--gray-100); vertical-align: middle; }
  .matrix-table tbody td:first-child { position: sticky; left: 0; background: white; z-index: 5; font-weight: 500; color: var(--gray-800); min-width: 220px; }
  .matrix-table tbody tr:hover td { background: var(--blue-50); }
  .matrix-table tbody tr:hover td:first-child { background: var(--blue-50); }
  .matrix-table .category-row td {
    background: var(--gray-50) !important; font-weight: 700; font-size: 11px;
    text-transform: uppercase; letter-spacing: 0.8px; color: var(--gray-500);
    padding: 8px 16px; border-bottom: 1px solid var(--gray-200);
  }

  .pill { display: inline-flex; align-items: center; gap: 5px; padding: 3px 10px; border-radius: 12px; font-size: 12px; font-weight: 500; white-space: nowrap; }
  .pill-enabled { background: var(--green-100); color: var(--green-700); }
  .pill-disabled { background: var(--red-100); color: var(--red-700); }
  .pill-na { background: var(--gray-100); color: var(--gray-400); font-style: italic; }
  .pill-not-live { background: var(--amber-50); color: var(--amber-600); font-style: italic; border: 1px dashed var(--amber-100); }
  .pill-value { background: var(--blue-100); color: var(--blue-700); }
  .pill-dot { width: 6px; height: 6px; border-radius: 50%; }
  .pill-enabled .pill-dot { background: var(--green-600); }
  .pill-disabled .pill-dot { background: var(--red-600); }

  .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(420px, 1fr)); gap: 20px; }
  .customer-card { background: white; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--gray-200); overflow: hidden; transition: box-shadow 0.2s; }
  .customer-card:hover { box-shadow: var(--shadow-lg); }
  .card-header { padding: 16px 20px; border-bottom: 1px solid var(--gray-100); display: flex; align-items: center; justify-content: space-between; }
  .card-customer-name { font-size: 16px; font-weight: 700; color: var(--gray-900); }
  .card-product-badges { display: flex; gap: 6px; }
  .product-badge { padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; }
  .badge-sepsis { background: var(--red-50); color: var(--red-600); border: 1px solid var(--red-100); }
  .badge-palliative { background: var(--purple-50); color: var(--purple-600); border: 1px solid var(--purple-100); }
  .badge-deterioration { background: var(--amber-50); color: var(--amber-600); border: 1px solid var(--amber-100); }
  .card-body { padding: 0; }
  .card-product-section { border-bottom: 1px solid var(--gray-100); }
  .card-product-section:last-child { border-bottom: none; }
  .card-product-title { padding: 10px 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--gray-500); background: var(--gray-50); border-bottom: 1px solid var(--gray-100); }
  .flag-list { list-style: none; }
  .flag-item { display: flex; align-items: center; justify-content: space-between; padding: 8px 20px; border-bottom: 1px solid var(--gray-50); font-size: 13px; }
  .flag-item:last-child { border-bottom: none; }
  .flag-item:hover { background: var(--gray-50); }
  .flag-name { color: var(--gray-700); }
  .flag-category-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--gray-400); margin-left: 8px; }
  .card-footer { padding: 12px 20px; background: var(--gray-50); border-top: 1px solid var(--gray-100); display: flex; justify-content: space-between; font-size: 12px; color: var(--gray-500); }

  .product-section { margin-bottom: 32px; }
  .product-section-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
  .product-section-title { font-size: 18px; font-weight: 700; color: var(--gray-900); }
  .product-customer-count { font-size: 13px; color: var(--gray-500); }
  .product-table-container { background: white; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--gray-200); overflow-x: auto; }
  .product-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .product-table thead th { background: var(--gray-50); padding: 12px 16px; text-align: left; font-weight: 600; color: var(--gray-700); border-bottom: 2px solid var(--gray-200); white-space: nowrap; }
  .product-table tbody td { padding: 10px 16px; border-bottom: 1px solid var(--gray-100); }
  .product-table tbody tr:hover td { background: var(--blue-50); }
  .product-table .category-row td { background: var(--gray-50) !important; font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 0.8px; color: var(--gray-500); padding: 8px 16px; }

  .no-results { text-align: center; padding: 48px 24px; color: var(--gray-400); }
  .no-results-icon { font-size: 48px; margin-bottom: 12px; display: block; }
  .no-results-text { font-size: 16px; font-weight: 500; }
  .no-results-sub { font-size: 13px; margin-top: 4px; }

  @media (max-width: 768px) {
    .header { padding: 16px; }
    .main { padding: 16px; }
    .cards-grid { grid-template-columns: 1fr; }
    .search-box input { width: 180px; }
    .search-box input:focus { width: 220px; }
    .stats-bar { grid-template-columns: repeat(2, 1fr); }
    .filter-bar { gap: 8px; }
  }

  .hidden { display: none !important; }

  .has-note { position: relative; cursor: help; }
  .has-note::after { content: "*"; color: var(--amber-600); font-weight: 700; margin-left: 4px; font-size: 14px; }
  .note-text { display: block; font-size: 11px; color: var(--gray-400); margin-top: 2px; font-style: italic; line-height: 1.3; }

  .legend { display: flex; gap: 16px; align-items: center; margin-bottom: 16px; flex-wrap: wrap; }
  .legend-label { font-size: 12px; color: var(--gray-500); font-weight: 600; }
  .legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--gray-600); }
</style>
</head>
<body>

<div class="header">
  <div class="header-inner">
    <div>
      <h1>Feature Flag Configuration</h1>
      <div class="header-subtitle">Clinical team configuration viewer</div>
    </div>
    <div class="header-right">
      <div class="search-box">
        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" id="searchInput" placeholder="Search flags...">
      </div>
      <span class="last-updated">Updated Feb 11, 2026</span>
    </div>
  </div>
</div>

<div class="main">
  <div class="stats-bar" id="statsBar"></div>

  <div class="filter-bar">
    <div class="filter-group">
      <label>Customer:</label>
      <div id="customerFilters"></div>
    </div>
    <div class="filter-divider"></div>
    <div class="filter-group">
      <label>Product:</label>
      <div id="productFilters"></div>
    </div>
    <div class="filter-divider"></div>
    <div class="filter-group">
      <label>Status:</label>
      <div id="statusFilters"></div>
    </div>
    <div class="filter-divider"></div>
    <div class="filter-group">
      <label>Category:</label>
      <div id="categoryFilters"></div>
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" data-view="matrix">Overview</div>
    <div class="tab" data-view="product">By Product</div>
    <div class="tab" data-view="customer">By Customer</div>
  </div>

  <div class="legend">
    <span class="legend-label">Legend:</span>
    <span class="legend-item"><span class="pill pill-enabled"><span class="pill-dot"></span>Enabled</span></span>
    <span class="legend-item"><span class="pill pill-disabled"><span class="pill-dot"></span>Disabled</span></span>
    <span class="legend-item"><span class="pill pill-value">Value</span></span>
    <span class="legend-item"><span class="pill pill-na">N/A</span></span>
    <span class="legend-item"><span class="pill pill-not-live">Not Live</span></span>
  </div>

  <div id="matrixView"></div>
  <div id="productView" class="hidden"></div>
  <div id="customerView" class="hidden"></div>
</div>

<script>
// ===== DATA (auto-generated from data/feature-flags.json â€” do not edit) =====
const FLAG_DATA = {
  "products": [
    "Sepsis",
    "Palliative Care",
    "Deterioration"
  ],
  "customers": {
    "Memorial Care": [
      "Sepsis"
    ],
    "Inova Health": [
      "Sepsis"
    ],
    "ThedaCare": [
      "Sepsis"
    ],
    "MedStar Health": [
      "Sepsis"
    ],
    "Mayo Clinic": [
      "Palliative Care"
    ],
    "CCF": [
      "Sepsis"
    ],
    "UChicago": [
      "Palliative Care",
      "Sepsis"
    ],
    "URMC": [
      "Deterioration",
      "Sepsis"
    ]
  },
  "flags": {
    "general": [
      {
        "key": "bundle_tracking",
        "name": "Bundle Tracking",
        "type": "boolean",
        "products": "all"
      },
      {
        "key": "fluid_mod_bayesian_ui",
        "name": "Fluid Modification (Bayesian UI)",
        "type": "boolean",
        "products": [
          "Sepsis"
        ]
      },
      {
        "key": "fluid_mod_ehr_order_set",
        "name": "Fluid Modification (EHR Order Set)",
        "type": "boolean",
        "products": [
          "Sepsis"
        ]
      },
      {
        "key": "investigational_banner",
        "name": "Investigational Banner",
        "type": "boolean",
        "products": "all"
      },
      {
        "key": "ifu",
        "name": "Instructions for Use (IFU)",
        "type": "boolean",
        "products": "all"
      }
    ],
    "nurses": [
      {
        "key": "nurse_escalation_questions",
        "name": "Nurse Assessment - Provider Escalation Questions",
        "type": "boolean",
        "products": "all"
      },
      {
        "key": "nurse_writeback_flowsheet",
        "name": "Nurse Assessment - Auto Writeback to Flowsheet Rows",
        "type": "boolean",
        "products": "all"
      },
      {
        "key": "nurse_writeback_note",
        "name": "Nurse Assessment - Auto Writeback as Clinical Note",
        "type": "boolean",
        "products": "all"
      },
      {
        "key": "nurse_order_set",
        "name": "Nurse Order Set Enabled",
        "type": "boolean",
        "products": [
          "Sepsis"
        ]
      },
      {
        "key": "qsofa",
        "name": "qSOFA",
        "type": "boolean",
        "products": [
          "Sepsis"
        ]
      }
    ],
    "providers": [
      {
        "key": "provider_flowsheet_writeback",
        "name": "Provider Assessment - Auto Flowsheet Writeback",
        "type": "boolean",
        "products": "all"
      },
      {
        "key": "provider_doc_tab",
        "name": "Provider Documentation Tab in Treatment Management",
        "type": "boolean",
        "products": "all"
      },
      {
        "key": "provider_fluid_questions",
        "name": "Provider - Fluid Documentation Questions",
        "type": "boolean",
        "products": [
          "Sepsis"
        ]
      },
      {
        "key": "create_new_note",
        "name": "Create a New Note Button",
        "type": "boolean",
        "products": "all"
      },
      {
        "key": "add_to_existing_note",
        "name": "Add to Existing Note Button",
        "type": "boolean",
        "products": "all"
      },
      {
        "key": "auto_writeback_note_type",
        "name": "Automatic Flowsheet Writeback of Note Type",
        "type": "boolean",
        "products": [
          "Sepsis"
        ]
      },
      {
        "key": "focused_exam_writeback",
        "name": "Focused Exam Writeback to Flowsheet Row",
        "type": "boolean",
        "products": [
          "Sepsis"
        ]
      },
      {
        "key": "focused_exam_read",
        "name": "Focused Exam Read from Flowsheet",
        "type": "boolean",
        "products": [
          "Sepsis"
        ]
      },
      {
        "key": "provider_order_set",
        "name": "Provider Order Set Enabled",
        "type": "boolean",
        "products": [
          "Sepsis"
        ]
      },
      {
        "key": "bundle_start_provider_trigger",
        "name": "Bundle Start Time by Provider Trigger",
        "type": "boolean",
        "products": [
          "Sepsis"
        ]
      },
      {
        "key": "ibw_calculation",
        "name": "Ideal Body Weight Calculation",
        "type": "boolean",
        "products": [
          "Sepsis"
        ]
      },
      {
        "key": "auto_obesity_contraindication",
        "name": "Auto-Selection of Obesity Contraindication",
        "type": "boolean",
        "products": [
          "Sepsis"
        ]
      }
    ]
  },
  "notes": {
    "Memorial Care": {
      "Sepsis": {
        "nurse_escalation_questions": "Unsure if they have provided the existing flowsheet",
        "nurse_order_set": "Primary user is rapid response nurses; managed through education",
        "provider_fluid_questions": "Fluid reason question is in the orderset; Bayesian pulls from flowsheets",
        "create_new_note": "\"Chg in Clinical Condition\" note",
        "add_to_existing_note": "Dot-phrase name TBD; build by ClinDoc team",
        "provider_order_set": "Order Panel ID varies between ED and inpatient locations"
      }
    },
    "Inova Health": {
      "Sepsis": {
        "create_new_note": "Still need to determine note type",
        "provider_order_set": "Order set button navigates to Managed Orders in Epic"
      }
    },
    "ThedaCare": {
      "Sepsis": {
        "fluid_mod_ehr_order_set": "Not pulling fluid contraindication from EHR (only IBW derived from weight and height)",
        "nurse_escalation_questions": "Unsure if they have provided the existing flowsheet",
        "nurse_order_set": "Currently enabled (can turn off later)",
        "provider_fluid_questions": "Fluid orders in order set but no reasoning for contraindications",
        "create_new_note": "Progress note",
        "add_to_existing_note": "ThedaCare built smartphrase integration using Bayesian flowsheet data",
        "provider_order_set": "Order Panel ID varies between ED and inpatient locations"
      }
    },
    "MedStar Health": {
      "Sepsis": {
        "fluid_mod_ehr_order_set": "TBD if MedStar order set includes this data",
        "investigational_banner": "Active in all application screens",
        "ifu": "IFU required",
        "nurse_order_set": "qSOFA score will auto order lactate",
        "qsofa": "Nursing assessment Q2 drives scoring of modified qSOFA",
        "provider_order_set": "Clinicians manually navigate to orders; MedStar could not build MPage without hyperlink"
      }
    }
  },
  "configurations": {
    "Memorial Care": {
      "Sepsis": {
        "bundle_tracking": true,
        "fluid_mod_bayesian_ui": false,
        "fluid_mod_ehr_order_set": true,
        "investigational_banner": false,
        "ifu": false,
        "nurse_escalation_questions": true,
        "nurse_writeback_flowsheet": true,
        "nurse_writeback_note": false,
        "nurse_order_set": true,
        "qsofa": false,
        "provider_flowsheet_writeback": false,
        "provider_doc_tab": true,
        "provider_fluid_questions": false,
        "create_new_note": true,
        "add_to_existing_note": false,
        "auto_writeback_note_type": true,
        "focused_exam_writeback": false,
        "focused_exam_read": false,
        "provider_order_set": true,
        "bundle_start_provider_trigger": false,
        "ibw_calculation": false,
        "auto_obesity_contraindication": false
      }
    },
    "Inova Health": {
      "Sepsis": {
        "bundle_tracking": true,
        "fluid_mod_bayesian_ui": true,
        "fluid_mod_ehr_order_set": true,
        "investigational_banner": false,
        "ifu": false,
        "nurse_escalation_questions": true,
        "nurse_writeback_flowsheet": true,
        "nurse_writeback_note": false,
        "nurse_order_set": false,
        "qsofa": false,
        "provider_flowsheet_writeback": true,
        "provider_doc_tab": true,
        "provider_fluid_questions": true,
        "create_new_note": true,
        "add_to_existing_note": false,
        "auto_writeback_note_type": true,
        "focused_exam_writeback": true,
        "focused_exam_read": true,
        "provider_order_set": true,
        "bundle_start_provider_trigger": true,
        "ibw_calculation": true,
        "auto_obesity_contraindication": true
      }
    },
    "ThedaCare": {
      "Sepsis": {
        "bundle_tracking": true,
        "fluid_mod_bayesian_ui": true,
        "fluid_mod_ehr_order_set": true,
        "investigational_banner": false,
        "ifu": false,
        "nurse_escalation_questions": true,
        "nurse_writeback_flowsheet": true,
        "nurse_writeback_note": false,
        "nurse_order_set": false,
        "qsofa": false,
        "provider_flowsheet_writeback": true,
        "provider_doc_tab": true,
        "provider_fluid_questions": true,
        "create_new_note": true,
        "add_to_existing_note": true,
        "auto_writeback_note_type": true,
        "focused_exam_writeback": true,
        "focused_exam_read": true,
        "provider_order_set": true,
        "bundle_start_provider_trigger": true,
        "ibw_calculation": true,
        "auto_obesity_contraindication": true
      }
    },
    "MedStar Health": {
      "Sepsis": {
        "bundle_tracking": true,
        "fluid_mod_bayesian_ui": true,
        "fluid_mod_ehr_order_set": true,
        "investigational_banner": true,
        "ifu": true,
        "nurse_escalation_questions": true,
        "nurse_writeback_flowsheet": true,
        "nurse_writeback_note": false,
        "nurse_order_set": false,
        "qsofa": true,
        "provider_flowsheet_writeback": true,
        "provider_doc_tab": true,
        "provider_fluid_questions": true,
        "create_new_note": true,
        "add_to_existing_note": true,
        "auto_writeback_note_type": true,
        "focused_exam_writeback": true,
        "focused_exam_read": false,
        "provider_order_set": false,
        "bundle_start_provider_trigger": false,
        "ibw_calculation": false,
        "auto_obesity_contraindication": false
      }
    },
    "Mayo Clinic": {
      "Palliative Care": {
        "bundle_tracking": false,
        "investigational_banner": false,
        "ifu": false,
        "nurse_escalation_questions": true,
        "nurse_writeback_flowsheet": true,
        "nurse_writeback_note": false,
        "provider_flowsheet_writeback": true,
        "provider_doc_tab": true,
        "create_new_note": true,
        "add_to_existing_note": false
      }
    },
    "CCF": {
      "Sepsis": {
        "bundle_tracking": true,
        "fluid_mod_bayesian_ui": true,
        "fluid_mod_ehr_order_set": true,
        "investigational_banner": false,
        "ifu": false,
        "nurse_escalation_questions": true,
        "nurse_writeback_flowsheet": true,
        "nurse_writeback_note": false,
        "nurse_order_set": true,
        "qsofa": false,
        "provider_flowsheet_writeback": true,
        "provider_doc_tab": true,
        "provider_fluid_questions": true,
        "create_new_note": true,
        "add_to_existing_note": true,
        "auto_writeback_note_type": true,
        "focused_exam_writeback": true,
        "focused_exam_read": false,
        "provider_order_set": true,
        "bundle_start_provider_trigger": false,
        "ibw_calculation": false,
        "auto_obesity_contraindication": false
      }
    },
    "UChicago": {
      "Palliative Care": {
        "bundle_tracking": false,
        "investigational_banner": false,
        "ifu": false,
        "nurse_escalation_questions": true,
        "nurse_writeback_flowsheet": true,
        "nurse_writeback_note": false,
        "provider_flowsheet_writeback": false,
        "provider_doc_tab": true,
        "create_new_note": true,
        "add_to_existing_note": false
      },
      "Sepsis": {
        "bundle_tracking": true,
        "fluid_mod_bayesian_ui": true,
        "fluid_mod_ehr_order_set": false,
        "investigational_banner": false,
        "ifu": false,
        "nurse_escalation_questions": true,
        "nurse_writeback_flowsheet": true,
        "nurse_writeback_note": false,
        "nurse_order_set": false,
        "qsofa": false,
        "provider_flowsheet_writeback": true,
        "provider_doc_tab": true,
        "provider_fluid_questions": true,
        "create_new_note": true,
        "add_to_existing_note": false,
        "auto_writeback_note_type": true,
        "focused_exam_writeback": false,
        "focused_exam_read": false,
        "provider_order_set": true,
        "bundle_start_provider_trigger": false,
        "ibw_calculation": false,
        "auto_obesity_contraindication": false
      }
    },
    "URMC": {
      "Deterioration": {
        "bundle_tracking": false,
        "investigational_banner": false,
        "ifu": false,
        "nurse_escalation_questions": true,
        "nurse_writeback_flowsheet": true,
        "nurse_writeback_note": false,
        "provider_flowsheet_writeback": true,
        "provider_doc_tab": true,
        "create_new_note": true,
        "add_to_existing_note": false
      },
      "Sepsis": {
        "bundle_tracking": true,
        "fluid_mod_bayesian_ui": false,
        "fluid_mod_ehr_order_set": false,
        "investigational_banner": false,
        "ifu": false,
        "nurse_escalation_questions": true,
        "nurse_writeback_flowsheet": true,
        "nurse_writeback_note": false,
        "nurse_order_set": false,
        "qsofa": false,
        "provider_flowsheet_writeback": true,
        "provider_doc_tab": true,
        "provider_fluid_questions": false,
        "create_new_note": true,
        "add_to_existing_note": false,
        "auto_writeback_note_type": true,
        "focused_exam_writeback": false,
        "focused_exam_read": false,
        "provider_order_set": true,
        "bundle_start_provider_trigger": false,
        "ibw_calculation": false,
        "auto_obesity_contraindication": false
      }
    }
  }
};

// ===== STATE =====
const state = {
  view: "matrix",
  search: "",
  customerFilter: "all",
  productFilter: "all",
  statusFilter: "all",
  categoryFilter: "all"
};

// ===== HELPERS =====
function getAllFlags() {
  return [
    ...FLAG_DATA.flags.general.map(f => ({ ...f, category: "general" })),
    ...FLAG_DATA.flags.nurses.map(f => ({ ...f, category: "nurses" })),
    ...FLAG_DATA.flags.providers.map(f => ({ ...f, category: "providers" }))
  ];
}

function getFlagNote(customer, product, flagKey) {
  return FLAG_DATA.notes?.[customer]?.[product]?.[flagKey] || "";
}

function getCustomerProductPairs() {
  const pairs = [];
  for (const [customer, products] of Object.entries(FLAG_DATA.customers)) {
    for (const product of products) {
      pairs.push({ customer, product });
    }
  }
  return pairs;
}

function isFlagApplicable(flag, product) {
  return flag.products === "all" || flag.products.includes(product);
}

function getFlagValue(customer, product, flagKey) {
  const config = FLAG_DATA.configurations[customer]?.[product];
  if (!config) return undefined;
  return config[flagKey];
}

function renderPill(value, flag, applicable, notLive) {
  if (notLive) return '<span class="pill pill-not-live">Not Live</span>';
  if (!applicable) return '<span class="pill pill-na">N/A</span>';
  if (value === undefined) return '<span class="pill pill-na">N/A</span>';
  if (typeof value === "string") return `<span class="pill pill-value">${value}</span>`;
  if (value === true) return '<span class="pill pill-enabled"><span class="pill-dot"></span>Enabled</span>';
  return '<span class="pill pill-disabled"><span class="pill-dot"></span>Disabled</span>';
}

function productBadgeClass(product) {
  if (product === "Sepsis") return "badge-sepsis";
  if (product === "Palliative Care") return "badge-palliative";
  if (product === "Deterioration") return "badge-deterioration";
  return "";
}

function matchesSearch(flagName) {
  if (!state.search) return true;
  return flagName.toLowerCase().includes(state.search.toLowerCase());
}

function matchesFilters(customer, product, flag, value) {
  if (state.customerFilter !== "all" && customer !== state.customerFilter) return false;
  if (state.productFilter !== "all" && product !== state.productFilter) return false;
  if (state.categoryFilter !== "all" && flag.category !== state.categoryFilter) return false;
  if (state.statusFilter !== "all") {
    if (state.statusFilter === "enabled" && value !== true && typeof value !== "string") return false;
    if (state.statusFilter === "disabled" && value !== false) return false;
  }
  return true;
}

// ===== STATS =====
function renderStats() {
  const pairs = getCustomerProductPairs();
  const allFlags = getAllFlags();
  let totalEnabled = 0, totalDisabled = 0, totalFlags = 0;
  for (const { customer, product } of pairs) {
    for (const flag of allFlags) {
      if (!isFlagApplicable(flag, product)) continue;
      totalFlags++;
      const val = getFlagValue(customer, product, flag.key);
      if (val === true || typeof val === "string") totalEnabled++;
      else totalDisabled++;
    }
  }
  document.getElementById("statsBar").innerHTML = `
    <div class="stat-card">
      <div class="stat-label">Customers</div>
      <div class="stat-value">${Object.keys(FLAG_DATA.customers).length}</div>
      <div class="stat-detail">${pairs.length} customer-product configs</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Products</div>
      <div class="stat-value">${FLAG_DATA.products.length}</div>
      <div class="stat-detail">${FLAG_DATA.products.join(", ")}</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Flags Defined</div>
      <div class="stat-value">${allFlags.length}</div>
      <div class="stat-detail">${FLAG_DATA.flags.general.length} general, ${FLAG_DATA.flags.nurses.length} nurses, ${FLAG_DATA.flags.providers.length} providers</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Enabled / Disabled</div>
      <div class="stat-value" style="color:var(--green-600)">${totalEnabled} <span style="color:var(--gray-300)">/</span> <span style="color:var(--red-600)">${totalDisabled}</span></div>
      <div class="stat-detail">${Math.round(totalEnabled / totalFlags * 100)}% enabled across all configs</div>
    </div>
  `;
}

// ===== FILTERS =====
function renderFilters() {
  const customers = Object.keys(FLAG_DATA.customers);
  const products = FLAG_DATA.products;

  document.getElementById("customerFilters").innerHTML =
    `<span class="filter-chip ${state.customerFilter === 'all' ? 'active' : ''}" data-filter="customer" data-value="all">All</span>` +
    customers.map(c => `<span class="filter-chip ${state.customerFilter === c ? 'active' : ''}" data-filter="customer" data-value="${c}">${c}</span>`).join("");

  document.getElementById("productFilters").innerHTML =
    `<span class="filter-chip ${state.productFilter === 'all' ? 'active' : ''}" data-filter="product" data-value="all">All</span>` +
    products.map(p => `<span class="filter-chip ${state.productFilter === p ? 'active' : ''}" data-filter="product" data-value="${p}">${p}</span>`).join("");

  document.getElementById("statusFilters").innerHTML =
    `<span class="filter-chip ${state.statusFilter === 'all' ? 'active' : ''}" data-filter="status" data-value="all">All</span>` +
    `<span class="filter-chip ${state.statusFilter === 'enabled' ? 'active' : ''}" data-filter="status" data-value="enabled">Enabled</span>` +
    `<span class="filter-chip ${state.statusFilter === 'disabled' ? 'active' : ''}" data-filter="status" data-value="disabled">Disabled</span>`;

  document.getElementById("categoryFilters").innerHTML =
    `<span class="filter-chip ${state.categoryFilter === 'all' ? 'active' : ''}" data-filter="category" data-value="all">All</span>` +
    `<span class="filter-chip ${state.categoryFilter === 'general' ? 'active' : ''}" data-filter="category" data-value="general">General</span>` +
    `<span class="filter-chip ${state.categoryFilter === 'nurses' ? 'active' : ''}" data-filter="category" data-value="nurses">Nurses</span>` +
    `<span class="filter-chip ${state.categoryFilter === 'providers' ? 'active' : ''}" data-filter="category" data-value="providers">Providers</span>`;
}

// ===== CUSTOMER VIEW =====
function renderCustomerView() {
  const customers = Object.entries(FLAG_DATA.customers).filter(([c]) =>
    state.customerFilter === "all" || state.customerFilter === c
  );
  const allFlags = getAllFlags();

  if (customers.length === 0) {
    document.getElementById("customerView").innerHTML = `<div class="no-results"><span class="no-results-icon">&#128269;</span><div class="no-results-text">No customers match filters</div></div>`;
    return;
  }

  let html = '<div class="cards-grid">';
  for (const [customer, products] of customers) {
    const filteredProducts = products.filter(p => state.productFilter === "all" || state.productFilter === p);
    if (filteredProducts.length === 0) continue;

    let enabledCount = 0, disabledCount = 0;
    html += `<div class="customer-card"><div class="card-header"><span class="card-customer-name">${customer}</span><div class="card-product-badges">`;
    for (const p of filteredProducts) {
      html += `<span class="product-badge ${productBadgeClass(p)}">${p}</span>`;
    }
    html += '</div></div><div class="card-body">';

    for (const product of filteredProducts) {
      html += `<div class="card-product-section">`;
      if (filteredProducts.length > 1) {
        html += `<div class="card-product-title">${product}</div>`;
      }
      html += '<ul class="flag-list">';
      const categories = [
        { key: "general", label: "General" },
        { key: "nurses", label: "Nurses" },
        { key: "providers", label: "Providers" }
      ];
      for (const cat of categories) {
        if (state.categoryFilter !== "all" && state.categoryFilter !== cat.key) continue;
        const catFlags = allFlags.filter(f => f.category === cat.key && isFlagApplicable(f, product));
        for (const flag of catFlags) {
          if (!matchesSearch(flag.name)) continue;
          const val = getFlagValue(customer, product, flag.key);
          if (state.statusFilter === "enabled" && val !== true && typeof val !== "string") continue;
          if (state.statusFilter === "disabled" && val !== false) continue;
          if (val === true || typeof val === "string") enabledCount++; else disabledCount++;
          const note = getFlagNote(customer, product, flag.key);
          html += `<li class="flag-item"><span class="flag-name">${flag.name}<span class="flag-category-label">${cat.label}</span>${note ? '<span class="note-text">' + note + '</span>' : ''}</span>${renderPill(val, flag, true)}</li>`;
        }
      }
      html += '</ul></div>';
    }

    html += `</div><div class="card-footer"><span>${enabledCount} enabled</span><span>${disabledCount} disabled</span></div></div>`;
  }
  html += '</div>';
  document.getElementById("customerView").innerHTML = html;
}

// ===== PRODUCT VIEW =====
function renderProductView() {
  const products = FLAG_DATA.products.filter(p => state.productFilter === "all" || state.productFilter === p);
  const allFlags = getAllFlags();

  if (products.length === 0) {
    document.getElementById("productView").innerHTML = `<div class="no-results"><span class="no-results-icon">&#128269;</span><div class="no-results-text">No products match filters</div></div>`;
    return;
  }

  let html = '';
  for (const product of products) {
    const customersWithProduct = Object.entries(FLAG_DATA.customers)
      .filter(([c, prods]) => prods.includes(product) && (state.customerFilter === "all" || state.customerFilter === c))
      .map(([c]) => c);
    if (customersWithProduct.length === 0) continue;

    html += `<div class="product-section"><div class="product-section-header"><span class="product-badge ${productBadgeClass(product)}" style="font-size:13px;padding:5px 14px;">${product}</span><span class="product-section-title"></span><span class="product-customer-count">${customersWithProduct.length} customer${customersWithProduct.length > 1 ? 's' : ''}</span></div>`;
    html += '<div class="product-table-container"><table class="product-table"><thead><tr><th>Feature Flag</th>';
    for (const c of customersWithProduct) {
      html += `<th>${c}</th>`;
    }
    html += '</tr></thead><tbody>';

    const categories = [
      { key: "general", label: "General" },
      { key: "nurses", label: "Nurses" },
      { key: "providers", label: "Providers" }
    ];
    for (const cat of categories) {
      if (state.categoryFilter !== "all" && state.categoryFilter !== cat.key) continue;
      const catFlags = allFlags.filter(f => f.category === cat.key && isFlagApplicable(f, product));
      const visibleFlags = catFlags.filter(f => {
        if (!matchesSearch(f.name)) return false;
        if (state.statusFilter !== "all") {
          const anyMatch = customersWithProduct.some(c => {
            const val = getFlagValue(c, product, f.key);
            if (state.statusFilter === "enabled") return val === true || typeof val === "string";
            if (state.statusFilter === "disabled") return val === false;
            return true;
          });
          if (!anyMatch) return false;
        }
        return true;
      });
      if (visibleFlags.length === 0) continue;
      html += `<tr class="category-row"><td colspan="${customersWithProduct.length + 1}">${cat.label}</td></tr>`;
      for (const flag of visibleFlags) {
        html += `<tr><td style="font-weight:500">${flag.name}</td>`;
        for (const c of customersWithProduct) {
          const val = getFlagValue(c, product, flag.key);
          const note = getFlagNote(c, product, flag.key);
          html += `<td>${renderPill(val, flag, true)}${note ? '<span class="note-text">' + note + '</span>' : ''}</td>`;
        }
        html += '</tr>';
      }
    }

    html += '</tbody></table></div></div>';
  }
  document.getElementById("productView").innerHTML = html || `<div class="no-results"><span class="no-results-icon">&#128269;</span><div class="no-results-text">No flags match your search</div></div>`;
}

// ===== MATRIX VIEW =====
function renderMatrixView() {
  const allCustomers = Object.keys(FLAG_DATA.customers);
  const allProducts = FLAG_DATA.products;
  const allFlags = getAllFlags();

  // Filter customers based on filter
  const customers = allCustomers.filter(c => state.customerFilter === "all" || state.customerFilter === c);
  if (customers.length === 0) {
    document.getElementById("matrixView").innerHTML = `<div class="no-results"><span class="no-results-icon">&#128269;</span><div class="no-results-text">No customers match filters</div></div>`;
    return;
  }

  // Filter products
  const products = allProducts.filter(p => state.productFilter === "all" || state.productFilter === p);
  if (products.length === 0) {
    document.getElementById("matrixView").innerHTML = `<div class="no-results"><span class="no-results-icon">&#128269;</span><div class="no-results-text">No products match filters</div></div>`;
    return;
  }

  // Build column headers: each column is a customer-product pair (all combos, including not-live)
  const columns = [];
  for (const customer of customers) {
    for (const product of products) {
      columns.push({ customer, product, live: FLAG_DATA.customers[customer].includes(product) });
    }
  }

  if (columns.length === 0) {
    document.getElementById("matrixView").innerHTML = `<div class="no-results"><span class="no-results-icon">&#128269;</span><div class="no-results-text">No data to display</div></div>`;
    return;
  }

  let html = '<div class="matrix-container"><table class="matrix-table"><thead>';

  // Two header rows: customer name, then product name
  // First row: customer names spanning their product columns
  html += '<tr><th></th>';
  let i = 0;
  while (i < columns.length) {
    const customer = columns[i].customer;
    let span = 0;
    while (i + span < columns.length && columns[i + span].customer === customer) span++;
    html += `<th colspan="${span}" style="text-align:center;border-left:2px solid var(--gray-200)"><span class="col-header-customer">${customer}</span></th>`;
    i += span;
  }
  html += '</tr>';

  // Second row: product names
  html += '<tr><th>Feature Flag</th>';
  for (const col of columns) {
    const badge = productBadgeClass(col.product);
    const opacity = col.live ? '' : 'opacity:0.5;';
    html += `<th style="text-align:center;border-left:1px solid var(--gray-200);${opacity}"><span class="col-header-product">${col.product}</span>${!col.live ? '<br><span style="font-size:10px;color:var(--amber-600);font-style:italic">Not Live</span>' : ''}</th>`;
  }
  html += '</tr></thead><tbody>';

  // Rows: flags grouped by category
  const categories = [
    { key: "general", label: "General" },
    { key: "nurses", label: "Nurses" },
    { key: "providers", label: "Providers" }
  ];

  let hasVisibleRows = false;

  for (const cat of categories) {
    if (state.categoryFilter !== "all" && state.categoryFilter !== cat.key) continue;
    const catFlags = allFlags.filter(f => f.category === cat.key);

    // Filter by search and status
    const visibleFlags = catFlags.filter(f => {
      if (!matchesSearch(f.name)) return false;
      if (state.statusFilter !== "all") {
        const anyMatch = columns.some(col => {
          if (!col.live) return false;
          if (!isFlagApplicable(f, col.product)) return false;
          const val = getFlagValue(col.customer, col.product, f.key);
          if (state.statusFilter === "enabled") return val === true || typeof val === "string";
          if (state.statusFilter === "disabled") return val === false;
          return true;
        });
        if (!anyMatch) return false;
      }
      return true;
    });

    if (visibleFlags.length === 0) continue;
    hasVisibleRows = true;

    html += `<tr class="category-row"><td colspan="${columns.length + 1}">${cat.label}</td></tr>`;

    for (const flag of visibleFlags) {
      html += `<tr><td style="font-weight:500">${flag.name}</td>`;
      for (const col of columns) {
        const applicable = isFlagApplicable(flag, col.product);
        const isNotLive = !col.live;
        const val = isNotLive ? undefined : getFlagValue(col.customer, col.product, flag.key);
        const note = isNotLive ? "" : getFlagNote(col.customer, col.product, flag.key);
        html += `<td style="text-align:center;border-left:1px solid var(--gray-100)">${renderPill(val, flag, applicable, isNotLive)}${note ? '<span class="note-text">' + note + '</span>' : ''}</td>`;
      }
      html += '</tr>';
    }
  }

  if (!hasVisibleRows) {
    html += `<tr><td colspan="${columns.length + 1}" style="text-align:center;padding:32px;color:var(--gray-400)">No flags match your search</td></tr>`;
  }

  html += '</tbody></table></div>';
  document.getElementById("matrixView").innerHTML = html;
}

// ===== RENDER =====
function render() {
  renderStats();
  renderFilters();

  document.getElementById("matrixView").classList.toggle("hidden", state.view !== "matrix");
  document.getElementById("productView").classList.toggle("hidden", state.view !== "product");
  document.getElementById("customerView").classList.toggle("hidden", state.view !== "customer");

  if (state.view === "matrix") renderMatrixView();
  else if (state.view === "product") renderProductView();
  else if (state.view === "customer") renderCustomerView();
}

// ===== EVENTS =====
document.addEventListener("click", (e) => {
  if (e.target.classList.contains("tab")) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    e.target.classList.add("active");
    state.view = e.target.dataset.view;
    render();
  }
  if (e.target.classList.contains("filter-chip")) {
    const filter = e.target.dataset.filter;
    const value = e.target.dataset.value;
    if (filter === "customer") state.customerFilter = value;
    if (filter === "product") state.productFilter = value;
    if (filter === "status") state.statusFilter = value;
    if (filter === "category") state.categoryFilter = value;
    render();
  }
});

document.getElementById("searchInput").addEventListener("input", (e) => {
  state.search = e.target.value;
  render();
});

// Initial render
render();
</script>
</body>
</html>